-- UM_ORG definition
CREATE TABLE UM_ORG
(
    UM_ID              CHARACTER VARYING(36)                   NOT NULL,
    UM_ORG_NAME        CHARACTER VARYING(255)                  NOT NULL,
    UM_ORG_DESCRIPTION CHARACTER VARYING(1024),
    UM_CREATED_TIME    TIMESTAMP                               NOT NULL,
    UM_LAST_MODIFIED   TIMESTAMP                               NOT NULL,
    UM_STATUS          CHARACTER VARYING(255) DEFAULT 'ACTIVE' NOT NULL,
    UM_PARENT_ID       CHARACTER VARYING(36),
    UM_ORG_TYPE        CHARACTER VARYING(100)                  NOT NULL,
    PRIMARY KEY (UM_ID),
    FOREIGN KEY (UM_PARENT_ID) REFERENCES PUBLIC.UM_ORG (UM_ID) ON DELETE CASCADE ON UPDATE RESTRICT
);
CREATE INDEX IDX_UM_ORG_PARENT_ID ON PUBLIC.UM_ORG (UM_PARENT_ID);
CREATE UNIQUE INDEX IDX_UNIQUE_UM_ORG_ID ON PUBLIC.UM_ORG (UM_ID);

-- Table to store polices of sharing resources
CREATE TABLE UM_RESOURCE_SHARING_POLICY
(
    UM_ID                    INTEGER      NOT NULL AUTO_INCREMENT,
    UM_RESOURCE_TYPE         VARCHAR(255) NOT NULL,
    UM_RESOURCE_ID           VARCHAR(36)  NOT NULL,
    UM_INITIATING_ORG_ID     VARCHAR(36)  NOT NULL,
    UM_POLICY_HOLDING_ORG_ID VARCHAR(36)  NOT NULL,
    UM_SHARING_POLICY        VARCHAR(255) NOT NULL,
    PRIMARY KEY (UM_ID),
    FOREIGN KEY (UM_INITIATING_ORG_ID) REFERENCES UM_ORG (UM_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (UM_POLICY_HOLDING_ORG_ID) REFERENCES UM_ORG (UM_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

-- Table to store attributes related to shared resources
CREATE TABLE UM_SHARED_RESOURCE_ATTRIBUTES
(
    UM_ID                         INTEGER      NOT NULL AUTO_INCREMENT,
    UM_RESOURCE_SHARING_POLICY_ID INTEGER      NOT NULL,
    UM_SHARED_ATTRIBUTE_TYPE      VARCHAR(255) NOT NULL,
    UM_SHARED_ATTRIBUTE_ID        VARCHAR(36)  NOT NULL,
    PRIMARY KEY (UM_ID),
    FOREIGN KEY (UM_RESOURCE_SHARING_POLICY_ID) REFERENCES UM_RESOURCE_SHARING_POLICY (UM_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

INSERT INTO UM_ORG (UM_ID, UM_ORG_NAME, UM_ORG_DESCRIPTION, UM_CREATED_TIME, UM_LAST_MODIFIED, UM_STATUS, UM_PARENT_ID,
                    UM_ORG_TYPE)
VALUES ('10084a8d-113f-4211-a0d5-efe36b082211', 'Super', 'This is the super organization.',
        '2024-10-24 16:40:48.641555', '2024-10-24 16:40:48.641555', 'ACTIVE', NULL, 'TENANT'),
       ('c524c30a-cbd4-4169-ac9d-1ee3edf1bf16', 'org-all', NULL, '2024-11-19 07:19:01.16727',
        '2024-11-19 07:19:01.16727', 'ACTIVE', '10084a8d-113f-4211-a0d5-efe36b082211', 'TENANT'),
       ('cd5a1dcb-fff2-4c14-a073-c07b3caf1757', 'org-all-child1', NULL, '2024-11-19 07:19:17.677139',
        '2024-11-19 07:19:17.677139', 'ACTIVE', 'c524c30a-cbd4-4169-ac9d-1ee3edf1bf16', 'TENANT'),
       ('46edfee9-b9f7-4480-ab45-353a571eafb4', 'org-all-grandchild1', NULL, '2024-11-19 07:19:49.208315',
        '2024-11-19 07:19:49.208315', 'ACTIVE', 'cd5a1dcb-fff2-4c14-a073-c07b3caf1757', 'TENANT'),
       ('7cb4ab7e-9a25-44bd-a9e0-cf4e07d804dc', 'org-immediate', NULL, '2024-11-19 07:20:04.418474',
        '2024-11-19 07:20:04.418474', 'ACTIVE', '10084a8d-113f-4211-a0d5-efe36b082211', 'TENANT'),
       ('440ad5b6-6a41-4da7-aadd-272995d0e5db', 'org-immediate-child1', NULL, '2024-11-19 07:20:19.34002',
        '2024-11-19 07:20:19.34002', 'ACTIVE', '7cb4ab7e-9a25-44bd-a9e0-cf4e07d804dc', 'TENANT'),
       ('ea1a347c-0b2b-421a-a21a-50fb489bc41f', 'org-immediate-grandchild1', NULL, '2024-11-19 07:20:30.359943',
        '2024-11-19 07:20:30.359943', 'ACTIVE', '440ad5b6-6a41-4da7-aadd-272995d0e5db', 'TENANT');

INSERT INTO UM_RESOURCE_SHARING_POLICY (UM_RESOURCE_TYPE, UM_RESOURCE_ID, UM_INITIATING_ORG_ID, UM_POLICY_HOLDING_ORG_ID, UM_SHARING_POLICY)
VALUES
    ('USER', 'a07a3509-f646-498c-890e-cedb08cd1586', '10084a8d-113f-4211-a0d5-efe36b082211', 'c524c30a-cbd4-4169-ac9d-1ee3edf1bf16', 'SELECTIVE-003'),
    ('USER', '678afe66-36ed-4c0a-8789-b6f83c4f40dc', '10084a8d-113f-4211-a0d5-efe36b082211', 'c524c30a-cbd4-4169-ac9d-1ee3edf1bf16', 'SELECTIVE-003'),
    ('USER', '150b7b05-21bb-4b20-a7be-9e7a299969bb', '10084a8d-113f-4211-a0d5-efe36b082211', '7cb4ab7e-9a25-44bd-a9e0-cf4e07d804dc', 'SELECTIVE-005'),
    ('USER', '94154a9a-e177-404c-8504-d58a71db1f84', '10084a8d-113f-4211-a0d5-efe36b082211', 'c524c30a-cbd4-4169-ac9d-1ee3edf1bf16', 'SELECTIVE-003'),
    ('USER', '94154a9a-e177-404c-8504-d58a71db1f84', '10084a8d-113f-4211-a0d5-efe36b082211', 'c524c30a-cbd4-4169-ac9d-1ee3edf1bf16', 'SELECTIVE-005');

INSERT INTO UM_SHARED_RESOURCE_ATTRIBUTES (UM_RESOURCE_SHARING_POLICY_ID, UM_SHARED_ATTRIBUTE_TYPE, UM_SHARED_ATTRIBUTE_ID)
VALUES
    (1, 'ROLE', 'daea2340-4686-4929-b0c3-aad28237b065'),
    (2, 'ROLE', 'fcee2861-3687-4f66-b656-94591faf44ab'),
    (3, 'ROLE', 'daea2340-4686-4929-b0c3-aad28237b065'),
    (4, 'ROLE', 'fcee2861-3687-4f66-b656-94591faf44ab'),
    (5, 'ROLE', 'f0dd8c17-e085-4816-bed1-eee84052e3ab');
